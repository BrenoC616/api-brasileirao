const puppeteer=require("puppeteer"),etag=require("etag");module.exports={async getData(e,t){const{year:r}=e.params,s=await puppeteer.launch({headless:!1,args:["--no-sandbox","--disable-setuid-sandbox"]}),a=await s.newPage();await a.setRequestInterception(!0),a.on("request",e=>{"script"===e.resourceType()||"stylesheet"===e.resourceType()||"image"===e.resourceType()||"font"===e.resourceType()||"manifest"===e.resourceType()||"fetch"===e.resourceType()||"xhr"===e.resourceType()||"websocket"===e.resourceType()||"other"===e.resourceType()?e.abort():e.continue()}),await a.goto("https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2022",{waitUntil:"domcontentloaded"});try{const e=await a.evaluate(()=>{let e;e=document.querySelectorAll("#app > #menu-panel > article table.tabela-expandir tbody tr.expand-trigger");const t=[...e];let r={};return t.map((e,t)=>{const s=void 0===e.cells[12]?"":e.cells[12].children,a=[...s];console.log(a),r[t+1]={position:t+1,name:e.cells[0].children[3].title,points:parseInt(e.cells[1].innerText),matches:parseInt(e.cells[2].innerText),victories:parseInt(e.cells[3].innerText),draws:parseInt(e.cells[4].innerText),defeats:parseInt(e.cells[5].innerText),goalsFor:parseInt(e.cells[6].innerText),goalsAgainst:parseInt(e.cells[7].innerText),goalsDifference:parseInt(e.cells[8].innerText),yellowCards:parseInt(e.cells[9].innerText),redCards:parseInt(e.cells[10].innerText),performance:e.cells[11].innerText+"%",previousResults:a.map(({innerText:e})=>{switch(e){case"V":return"Victory";case"E":return"Draw";case"D":return"Defeat"}}),nextMatch:void 0===e.cells[13]||null===e.cells[13].firstChild?"Not Found":e.cells[13].firstElementChild.title}}),r});await s.close(),t.set("ETag",etag(JSON.stringify(e))),t.status(200).json(e)}catch(e){t.status(400).json({message:"Bad Request",error:e.message}),console.error(e)}}};